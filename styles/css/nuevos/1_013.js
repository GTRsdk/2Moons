(function(f){var j=0;f.cluetip={version:"1.0.3"};var k,i,h,e,g,b,l,d;f.fn.cluetip=function(n,m){if(typeof n=="object"){m=n;n=null}if(n=="destroy"){return this.unbind(".cluetip")}return this.each(function(M){var v=this,y=f(this);var J=f.extend(true,{},f.fn.cluetip.defaults,m||{},f.metadata?y.metadata():f.meta?y.data():{});var r=false;var C=+J.cluezIndex;y.data("thisInfo",{title:v.title,zIndex:C});var U=false,T=0;if(!f("#cluetip").length){f(['<div id="cluetip">','<div id="cluetip-outer">','<h3 id="cluetip-title"></h3>','<div id="cluetip-inner"></div>',"</div>",'<div id="cluetip-extra"></div>','<div id="cluetip-arrows" class="cluetip-arrows"></div>',"</div>"].join(""))[c](a).hide();k=f("#cluetip").css({position:"absolute"});h=f("#cluetip-outer").css({position:"relative",zIndex:C});i=f("#cluetip-inner");e=f("#cluetip-title");g=f("#cluetip-arrows");b=f('<div id="cluetip-waitimage"></div>').css({position:"absolute"}).insertBefore(k).hide()}var L=(J.dropShadow)?+J.dropShadowSteps:0;if(!l){l=f([]);for(var X=0;X<L;X++){l=l.add(f("<div></div>").css({zIndex:C-1,opacity:0.1,top:1+X,left:1+X}))}l.css({position:"absolute",backgroundColor:"#000"}).prependTo(k)}var H=y.attr(J.attribute),u=J.cluetipClass;if(!H&&!J.splitTitle&&!n){return true}if(J.local&&J.localPrefix){H=J.localPrefix+H}if(J.local&&J.hideLocal){f(H+":first").hide()}var I=parseInt(J.topOffset,10),E=parseInt(J.leftOffset,10);var D,V,A=isNaN(parseInt(J.height,10))?"auto":(/\D/g).test(J.height)?J.height:J.height+"px";var o,w,N,aa,P,W;var B=parseInt(J.width,10)||275,Y=B+(parseInt(k.css("paddingLeft"),10)||0)+(parseInt(k.css("paddingRight"),10)||0)+L,F=this.offsetWidth,x,O,ab,Q,q;var S;var K=(J.attribute!="title")?y.attr(J.titleAttribute):"";var p=K;if(J.splitTitle){if(K==undefined){K=""}S=K.split(J.splitTitle);K=S.shift()}if(J.escapeTitle){K=K.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;")}var t;var z=function(ac){if(!J.onActivate(y)){return false}clearTimeout(j);K=p;if(J.splitTitle){if(K==undefined){K=""}S=K.split(J.splitTitle);K=S.shift()}if(J.escapeTitle){K=K.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;")}U=true;k.removeClass().css({width:B});if(H==y.attr("href")){y.css("cursor",J.cursor)}if(J.hoverClass){y.addClass(J.hoverClass)}w=N=y.offset().top;x=y.offset().left;Q=ac.pageX;P=ac.pageY;if(v.tagName.toLowerCase()!="area"){o=f(document).scrollTop();q=f(window).width()}if(J.positionBy=="fixed"){O=F+x+E;k.css({left:O})}else{O=(F>x&&x>Y)||x+F+Y+E>q?x-Y-E:F+x+E;if(v.tagName.toLowerCase()=="area"||J.positionBy=="mouse"||F+Y>q){if(Q+20+Y>q){k.addClass(" cluetip-"+u);O=(Q-Y-E)>=0?Q-Y-E-parseInt(k.css("marginLeft"),10)+parseInt(i.css("marginRight"),10):Q-(Y/2)}else{O=Q+E}}var ad=O<0?ac.pageY+I:ac.pageY;k.css({left:(O>0&&J.positionBy!="bottomTop")?O:(Q+(Y/2)>q)?q/2-Y/2:Math.max(Q-(Y/2),0),zIndex:y.data("thisInfo").zIndex});g.css({zIndex:y.data("thisInfo").zIndex+1})}V=f(window).height();if(n){if(typeof n=="function"){n=n(v)}i.html(n);R(ad)}else{if(S){var af=S.length;i.html(S[0]);if(af>1){for(var ae=1;ae<af;ae++){i.append('<div class="split-body">'+S[ae]+"</div>")}}R(ad)}else{if(!J.local&&H.indexOf("#")!=0){if(/\.(jpe?g|tiff?|gif|png)$/i.test(H)){i.html('<img src="'+H+'" alt="'+K+'" />');R(ad)}else{if(r&&J.ajaxCache){i.html(r);R(ad)}else{var aj=J.ajaxSettings.beforeSend,ag=J.ajaxSettings.error,ah=J.ajaxSettings.success,am=J.ajaxSettings.complete;var al={cache:false,url:H,beforeSend:function(an){if(aj){aj.call(v,an,k,i)}h.children().empty();if(J.waitImage){b.css({top:P+20,left:Q+20,zIndex:y.data("thisInfo").zIndex-1}).show()}},error:function(an,ao){if(U){if(ag){ag.call(v,an,ao,k,i)}else{i.html("<i>sorry, the contents could not be loaded</i>")}}},success:function(an,ao){r=J.ajaxProcess.call(v,an);if(U){if(ah){ah.call(v,an,ao,k,i)}i.html(r)}},complete:function(an,ao){if(am){am.call(v,an,ao,k,i)}d=f("#cluetip-inner img").length;if(d&&!f.browser.opera){f("#cluetip-inner img").bind("load error",function(){d--;if(d<1){b.hide();if(U){R(ad)}}})}else{b.hide();if(U){R(ad)}}}};var ai=f.extend(true,{},J.ajaxSettings,al);f.ajax(ai)}}}else{if(J.local){var ak=f(H+(/#\S+$/.test(H)?"":":eq("+M+")")).clone(true).show();i.html(ak);R(ad)}}}}};var R=function(ae){k.addClass("cluetip-"+u);if(J.truncate){var af=i.text().slice(0,J.truncate)+"...";i.html(af)}function ac(){}K?e.show().html(K):(J.showTitle)?e.show().html("&nbsp;"):e.hide();if(J.sticky){var ad=f('<div id="cluetip-close"><a href="#">'+J.closeText+"</a></div>");(J.closePosition=="bottom")?ad.appendTo(i):(J.closePosition=="title")?ad.prependTo(e):ad.prependTo(i);ad.bind("click.cluetip",function(){G();return false});if(J.mouseOutClose){if(f.fn.hoverIntent&&J.hoverIntent){k.hoverIntent({over:ac,timeout:J.hoverIntent.timeout,out:function(){ad.trigger("click.cluetip")}})}else{k.hover(ac,function(){ad.trigger("click.cluetip")})}}else{k.unbind("mouseout")}}if(J.closeDelay>0){k.bind("mouseenter",function(){clearTimeout(j)}).bind("mouseleave",function(){j=setTimeout(G,J.closeDelay)})}var ag="";h.css({zIndex:y.data("thisInfo").zIndex,overflow:A=="auto"?"visible":"auto",height:A});D=A=="auto"?Math.max(k.outerHeight(),k.height()):parseInt(A,10);aa=N;W=o+V;if(J.positionBy=="fixed"){aa=N-J.dropShadowSteps+I}else{if((O<Q&&Math.max(O,0)+Y>Q)||J.positionBy=="bottomTop"){if(N+D+I>W&&P-o>D+I){aa=P-D-I;ag="top"}else{aa=P+I;ag="bottom"}}else{if(N+D+I>W){aa=(D>=V)?o:W-D-I}else{if(y.css("display")=="block"||v.tagName.toLowerCase()=="area"||J.positionBy=="mouse"){aa=ae-I}else{aa=N-J.dropShadowSteps}}}}if(ag==""){O<x?ag="left":ag="right"}k.css({top:aa+"px"}).removeClass().addClass("clue-"+ag+"-"+u).addClass(" cluetip-"+u);if(J.arrows){var ah=(N-aa-J.dropShadowSteps);g.css({top:(/(left|right)/.test(ag)&&O>=0&&ah>0)?ah+"px":/(left|right)/.test(ag)?0:""}).show()}else{g.hide()}l.hide();k.hide()[J.fx.open](J.fx.open!="show"&&J.fx.openSpeed);if(J.dropShadow){l.css({height:D,width:B,zIndex:y.data("thisInfo").zIndex-1}).show()}if(f.fn.bgiframe){k.bgiframe()}if(J.delayedClose>0){T=setTimeout(G,J.delayedClose)}J.onShow.call(v,k,i)};var Z=function(ac){U=false;b.hide();if(!J.sticky||(/click|toggle/).test(J.activation)){if(J.closeDelay>0){j=setTimeout(G,J.closeDelay)}else{G();clearTimeout(T)}}if(J.hoverClass){y.removeClass(J.hoverClass)}};var G=function(){clearTimeout(j);h.parent().hide().removeClass();J.onHide.call(v,k,i);y.removeClass("cluetip-clicked");if(K){y.attr(J.titleAttribute,p)}y.css("cursor","");if(J.arrows){g.css({top:""})}};f(document).bind("hideCluetip",function(ac){G()});if((/click|toggle/).test(J.activation)){y.bind("click.cluetip",function(ac){if(k.is(":hidden")||!y.is(".cluetip-clicked")){z(ac);f(".cluetip-clicked").removeClass("cluetip-clicked");y.addClass("cluetip-clicked")}else{Z(ac)}this.blur();return false})}else{if(J.activation=="focus"){y.bind("focus.cluetip",function(ac){z(ac)});y.bind("blur.cluetip",function(ac){Z(ac)})}else{y.bind("click.cluetip",function(){if(y.attr("href")&&y.attr("href")==H&&!J.clickThrough){return false}});var s=function(ac){if(J.tracking==true){var ae=O-ac.pageX;var ad=aa?aa-ac.pageY:N-ac.pageY;y.bind("mousemove.cluetip",function(af){k.css({left:af.pageX+ae,top:af.pageY+ad})})}};if(f.fn.hoverIntent&&J.hoverIntent){y.hoverIntent({sensitivity:J.hoverIntent.sensitivity,interval:J.hoverIntent.interval,over:function(ac){z(ac);s(ac)},timeout:J.hoverIntent.timeout,out:function(ac){Z(ac);y.unbind("mousemove.cluetip")}})}else{y.bind("mouseenter.cluetip",function(ac){z(ac);s(ac)}).bind("mouseleave.cluetip",function(ac){Z(ac);y.unbind("mousemove.cluetip")})}y.bind("mouseenter.cluetip",function(ac){p=(J.attribute!="title")?y.attr(J.titleAttribute):"";y.attr("title","")}).bind("mouseleave.cluetip",function(ac){y.attr("title",p)})}}})};f.fn.cluetip.defaults={width:275,height:"auto",cluezIndex:97,positionBy:"auto",topOffset:15,leftOffset:15,local:false,localPrefix:null,hideLocal:true,attribute:"rel",titleAttribute:"title",splitTitle:"",escapeTitle:false,showTitle:true,cluetipClass:"default",hoverClass:"",waitImage:true,cursor:"help",arrows:false,dropShadow:true,dropShadowSteps:6,sticky:false,mouseOutClose:false,activation:"hover",clickThrough:false,tracking:false,delayedClose:0,closePosition:"top",closeText:"Close",truncate:0,closeDelay:0,fx:{open:"show",openSpeed:""},hoverIntent:{sensitivity:3,interval:50,timeout:0},onActivate:function(m){return true},onShow:function(n,m){},onHide:function(n,m){},ajaxCache:true,ajaxProcess:function(m){m=m.replace(/<(script|style|title)[^<]+<\/(script|style|title)>/gm,"").replace(/<(link|meta)[^>]+>/g,"");return m},ajaxSettings:{dataType:"html"},debug:true};var c="appendTo",a="body";f.cluetip.setup=function(m){if(m&&m.insertionType&&(m.insertionType).match(/appendTo|prependTo|insertBefore|insertAfter/)){c=m.insertionType}if(m&&m.insertionElement){a=m.insertionElement}}})(jQuery);